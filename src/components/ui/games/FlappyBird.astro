---
// Beige Bird - Flappy Bird style game
---

<div class="game-wrapper">
  <canvas id="flappyCanvas" width="400" height="500"></canvas>
  <div class="game-overlay" id="flappyOverlay">
    <div class="game-start">
      <h4>Beige Bird</h4>
      <p>Tap Space or Click to flap!</p>
      <p class="controls">Navigate through the pipes</p>
      <button id="flappyStart" class="game-button">Start Game</button>
    </div>
  </div>
  <div class="game-score">
    <span>Score: <strong id="flappyScore">0</strong></span>
    <span>High: <strong id="flappyHigh">0</strong></span>
  </div>
</div>

<script>
  const canvas = document.getElementById('flappyCanvas') as HTMLCanvasElement;
  const ctx = canvas.getContext('2d')!;
  const overlay = document.getElementById('flappyOverlay')!;
  const startButton = document.getElementById('flappyStart')!;
  const scoreElement = document.getElementById('flappyScore')!;
  const highScoreElement = document.getElementById('flappyHigh')!;

  const COLORS = {
    bird: '#D4A574',
    pipe: '#3E3832',
    bg: '#FAF8F5',
    pipePass: '#C69563',
  };

  let gameRunning = false;
  let score = 0;
  let highScore = parseInt(localStorage.getItem('flappyHighScore') || '0');
  highScoreElement.textContent = highScore.toString();

  const bird = {
    x: 80,
    y: canvas.height / 2,
    radius: 15,
    velocity: 0,
    gravity: 0.4,
    jump: -8,
  };

  let pipes: Array<{ x: number; topHeight: number; gap: number; passed: boolean }> = [];
  const pipeWidth = 50;
  const pipeGap = 150;
  const pipeSpeed = 2;

  function flap() {
    if (gameRunning) {
      bird.velocity = bird.jump;
    }
  }

  document.addEventListener('keydown', (e) => {
    if (e.code === 'Space' && gameRunning) {
      e.preventDefault();
      flap();
    }
  });

  canvas.addEventListener('click', flap);
  canvas.addEventListener('touchstart', (e) => {
    e.preventDefault();
    flap();
  });

  function spawnPipe() {
    const minHeight = 50;
    const maxHeight = canvas.height - pipeGap - 50;
    const topHeight = minHeight + Math.random() * (maxHeight - minHeight);
    pipes.push({
      x: canvas.width,
      topHeight,
      gap: pipeGap,
      passed: false,
    });
  }

  function updateBird() {
    bird.velocity += bird.gravity;
    bird.y += bird.velocity;

    // Check boundaries
    if (bird.y - bird.radius < 0 || bird.y + bird.radius > canvas.height) {
      gameOver();
    }
  }

  function updatePipes() {
    pipes.forEach((pipe, index) => {
      pipe.x -= pipeSpeed;

      // Remove off-screen pipes
      if (pipe.x + pipeWidth < 0) {
        pipes.splice(index, 1);
      }

      // Score when bird passes pipe
      if (!pipe.passed && pipe.x + pipeWidth < bird.x) {
        pipe.passed = true;
        score++;
        scoreElement.textContent = score.toString();
      }

      // Collision detection
      const birdLeft = bird.x - bird.radius;
      const birdRight = bird.x + bird.radius;
      const birdTop = bird.y - bird.radius;
      const birdBottom = bird.y + bird.radius;

      if (
        birdRight > pipe.x &&
        birdLeft < pipe.x + pipeWidth &&
        (birdTop < pipe.topHeight || birdBottom > pipe.topHeight + pipe.gap)
      ) {
        gameOver();
      }
    });
  }

  function draw() {
    // Clear canvas
    ctx.fillStyle = COLORS.bg;
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Draw pipes
    pipes.forEach(pipe => {
      // Top pipe
      ctx.fillStyle = pipe.passed ? COLORS.pipePass : COLORS.pipe;
      ctx.fillRect(pipe.x, 0, pipeWidth, pipe.topHeight);

      // Bottom pipe
      ctx.fillRect(pipe.x, pipe.topHeight + pipe.gap, pipeWidth, canvas.height - pipe.topHeight - pipe.gap);

      // Pipe caps
      ctx.fillRect(pipe.x - 5, pipe.topHeight - 10, pipeWidth + 10, 10);
      ctx.fillRect(pipe.x - 5, pipe.topHeight + pipe.gap, pipeWidth + 10, 10);
    });

    // Draw bird
    ctx.fillStyle = COLORS.bird;
    ctx.beginPath();
    ctx.arc(bird.x, bird.y, bird.radius, 0, Math.PI * 2);
    ctx.fill();

    // Bird eye
    ctx.fillStyle = COLORS.pipe;
    ctx.beginPath();
    ctx.arc(bird.x + 5, bird.y - 3, 3, 0, Math.PI * 2);
    ctx.fill();
  }

  let frameCount = 0;
  function gameLoop() {
    if (!gameRunning) return;

    updateBird();
    updatePipes();
    draw();

    // Spawn pipes
    frameCount++;
    if (frameCount % 120 === 0) {
      spawnPipe();
    }

    requestAnimationFrame(gameLoop);
  }

  function startGame() {
    gameRunning = true;
    score = 0;
    pipes = [];
    frameCount = 0;
    bird.y = canvas.height / 2;
    bird.velocity = 0;
    scoreElement.textContent = '0';
    overlay.style.display = 'none';

    // Spawn initial pipes
    spawnPipe();

    requestAnimationFrame(gameLoop);
  }

  function gameOver() {
    gameRunning = false;

    if (score > highScore) {
      highScore = score;
      localStorage.setItem('flappyHighScore', highScore.toString());
      highScoreElement.textContent = highScore.toString();
    }

    overlay.innerHTML = `
      <div class="game-start">
        <h4>Game Over!</h4>
        <p>Score: <strong>${score}</strong></p>
        <p>High: <strong>${highScore}</strong></p>
        <button id="flappyRestart" class="game-button">Play Again</button>
      </div>
    `;
    overlay.style.display = 'flex';
    document.getElementById('flappyRestart')!.addEventListener('click', startGame);
  }

  startButton.addEventListener('click', startGame);
</script>

<style>
  .game-wrapper {
    position: relative;
    max-width: 400px;
    margin: 0 auto;
  }

  canvas {
    width: 100%;
    height: auto;
    border-radius: var(--radius-md);
    box-shadow: var(--shadow-lg);
    display: block;
    background: var(--color-bg-primary);
    cursor: pointer;
  }

  .game-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(250, 248, 245, 0.95);
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: var(--radius-md);
  }

  .game-start {
    text-align: center;
    padding: var(--space-6);
  }

  .game-start h4 {
    font-size: var(--font-size-xl);
    color: var(--color-text-primary);
    margin-bottom: var(--space-3);
  }

  .game-start p {
    color: var(--color-text-secondary);
    margin-bottom: var(--space-3);
  }

  .controls {
    font-size: var(--font-size-sm);
    color: var(--color-text-muted);
  }

  .game-button {
    background: var(--color-accent-primary);
    color: white;
    border: none;
    padding: var(--space-3) var(--space-6);
    border-radius: var(--radius-full);
    font-size: var(--font-size-base);
    font-weight: var(--font-weight-medium);
    cursor: pointer;
    transition: all var(--transition-fast);
  }

  .game-button:hover {
    background: var(--color-accent-hover);
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
  }

  .game-score {
    display: flex;
    justify-content: space-between;
    margin-top: var(--space-4);
    padding: var(--space-3) var(--space-4);
    background: var(--color-bg-tertiary);
    border-radius: var(--radius-md);
    font-size: var(--font-size-sm);
    color: var(--color-text-secondary);
  }

  .game-score strong {
    color: var(--color-accent-primary);
    font-size: var(--font-size-base);
  }
</style>
